<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<title>{{{ PRODUCT_NAME }}}</title>
	<style>
		body {
			padding: 0;
			margin: 0;
			box-sizing: border-box;
			background-color: #000;
		}

		#container {
			margin: 0 auto;
		}

		.label-loading {
			z-index: 3;
		}

		.loading-agt {
			border: transparent solid 1px;
			text-align: center;
		}

		.area-loading {
			position: relative;
			width: 50%;
			margin: 0 auto;
		}

		.logo-agt {
			width: 60%;
      height: 60%;
		}

		.bg-loading-agt {
			height: 60px;
		}
		.loading-bar-agt {
			position: absolute;
			width: 0%;
			height: 56%;
			left: 5%;
      top: 15%;
			background-image: url('./public/Loading_BarFill.png');
			background-size: auto 100%;
		}

		#unity-canvas {
			width: 100%;
			height: 100%;
		}

		#porcentagem-loading {
			color: #fff;
			font-size: 32px;
			font-weight: 800;
			margin-top: -5.5%;
			margin-bottom: 1%;
		}
	</style>
</head>
<body>
	<div id="container">
		<canvas id="unity-canvas" style="display: none;"></canvas>
		<main class="loading-agt" id="loading">
			<figure>
				<img src="./public/AGTLoader.png" alt="Logo Agt" class="logo-agt">
			</figure>
			<div id="porcentagem-loading">0%</div>
			<div id="area-load" class="area-loading">
				<img src="./public/Loading_BarBG.png" width="100%" class="bg-loading-agt">
				<div id="agt-loading" class="loading-bar-agt"></div>
			</div>
		</main>
	</div>
  <script>
    const maxPixelRatioMobile = 2.0;
    const maxPixelRatioDesktop = 1.5;
	const maxWidthLoadingBar = 90;

    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    var maxDevicePixelRatio = isMobile? maxPixelRatioMobile: maxPixelRatioDesktop;
    var pixelRatio = Math.min(window.devicePixelRatio, maxDevicePixelRatio);

    var buildUrl = "Build";
    var loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
    var config = {
      dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
      frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
      codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
	#if MEMORY_FILENAME
        memoryUrl: buildUrl + "/{{{ MEMORY_FILENAME }}}",
	#endif
	#if SYMBOLS_FILENAME
        symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}",
	#endif
      streamingAssetsUrl: "StreamingAssets",
      companyName: "{{{ COMPANY_NAME }}}",
      productName: "{{{ PRODUCT_NAME }}}",
      productVersion: "{{{ PRODUCT_VERSION }}}",
      devicePixelRatio: pixelRatio
    };

		const canvas = document.querySelector("#unity-canvas");
		const loading = document.querySelector("#loading");
		const loadingText = document.getElementById("porcentagem-loading");
		const agtLoading = document.getElementById("agt-loading");
		var GameInstance = null;
		const script = document.createElement("script");
		script.src = loaderUrl;
		script.onload = function () {
			createUnityInstance(canvas, config, function (progress) {
				const p = progress + 0.1;
				loadingText.innerText = Math.round(100 * p).toFixed(2) + "%";
				agtLoading.style.width = (maxWidthLoadingBar * p) + "%";
			}).then(function (unityInstance) {
				canvas.style.display = "block";
				loading.style.display = "none";
				GameInstance = unityInstance;
			}).catch(function (message) {
				alert(message);
			});
		};

		const resizeIframe = () => {
			const iframe = document.querySelector('#container');
			console.log("resizeIframe " + iframe);
			if (iframe) {
				console.log("resizeIframe()");
				const aspectRatio = 2;
				const width = window.innerWidth;
				const height = window.innerHeight;
				let newWidth = width;
				let newHeight = height;

				if (width > height) {
					if (width / height > aspectRatio) {
						newWidth = height * aspectRatio;
					} else {
						newHeight = width / aspectRatio;
					}
				} else {
					newWidth = width;
					newHeight = height;
				}

				iframe.style.width = `${width}px`;
				iframe.style.height = `${height}px`;
			}
		};

		(() => {
			resizeIframe();
			window.addEventListener('resize', resizeIframe);
			setTimeout(() => document.body.appendChild(script), 50);
		}) ();

  </script>
	<script>
		function GoToURL(url) {
			window.open(url, "_top");
		}

		function FullScreen() {
			if (!document.fullscreenElement) {
				if (document.documentElement.requestFullscreen) {
					document.documentElement.requestFullscreen();
				} else if (document.documentElement.webkitRequestFullscreen) {
					document.documentElement.webkitRequestFullscreen();
				} else if (document.documentElement.mozRequestFullScreen) {
					document.documentElement.mozRequestFullScreen();
				}else if (document.documentElement.msRequestFullscreen){  
					document.documentElement.msRequestFullscreen();
				}
			} else {
				document.exitFullscreen();
			}
		}
		

        function isScreenLockSupported() {
            return ('wakeLock' in navigator);
        }
        async function AwaitScreenLock(lock) {
            console.log(`AwaitScreenLock with lock of type ${typeof lock}`);
            if (lock == false) {
                if(typeof screenLock !== "undefined" && screenLock != null) {
                    screenLock.release().then(() => {
                        screenLock = null;
                    });
                }
            }
            else {
                if(isScreenLockSupported()){
                    try {
                        screenLock = await navigator.wakeLock.request('screen');
                    } catch(err) {
                        screenLock = "undefined";
                    }
                }
            }
        }
        let screenLock;
        function ScreenLock(lock) {
            AwaitScreenLock(lock);
        }
	</script>
</body>
</html>
